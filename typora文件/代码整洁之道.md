# 代码整洁之道

## 一. 整洁代码

### 1. 要有代码

代码是用来表达需求的语言, 永远无法抛弃必要的精确性。

### 2. 糟糕的代码

糟糕的代码无法管理, 不要写糟糕的代码。

###  3. 混乱的代价

初期进展迅速, 随着混乱的增加, 团队生产力逐渐降低。

![image-20210803085539518](E:\Notebook\typora文件\image-20210803085539518.png)

#### 3.1 华丽的新设计

新团队设计新系统加入竞争, 这种竞争可能持续长达十余年。

#### 3.2 态度

告知自己的想法以及对失败负有极大的责任

#### 3.3 谜题

开发者背负期限的压力, 只好制作混乱。制造混乱无助于赶上期限, 需要花时间让自己做的更快, 做的快的唯一方法是始终保持代码的整洁。

#### 3.4 整洁代码的艺术

- 怎么写出整洁的代码？ => 了解整洁对于代码的意义 
- 能分辨代码好坏不意味着会写整洁的代码
- 培养代码感, 遵循大量的小技巧   

#### 3.5 什么是整洁代码

Bjarne Stroustrup, C++语言发明者, 优雅高效, 使人愉悦：

- 代码逻辑直接了当.整洁的代码力求集中,每个模块,每个类,每个函数都全神贯注于一事.
- 减少依赖关系, 使之便于维护.
- 依据分层战略完善错误处理代码.
- 性能调至最优, 省的引诱别人做没规矩的优化.

破窗理论：窗户破损的建筑让人觉得无人照管, 于是别人也不在关心, 放任窗户继续破损,最终自己也参与其中.

Grady Booch,《面向对象分析与设计》作者:

- 整洁代码如同优美的散文, 让人印象深刻.
- 不隐藏设计者的意图(与上一点貌似存在冲突, 个人感觉散文的意图的确让人难以猜测).
- 干净利落,没有不必要的细节.

Dave Thomas, OTI公司创始人, Eclipse 战略教父:

- 整洁的代码可由作者以外的开发者阅读和增补.
- 有单元测试和验收测试.
- 使用有意义的命名.
- 提供一种而非多种做一件事的方法.
- 尽量少的依赖关系

他推崇小块的代码以及字面编程.

Michael Feathers, 《修改代码的艺术》作者:

- 在意你的代码

>  简单有序,注意细节

### 4. 思想流派

> 有各种流派,本书只是其中一种,多学习,形成自己的流派.大概,估计,应该就是这个意思吧,哈哈.

### 5. 我们是作者

> 开发人员是作者也是读者,不读周边代码就无法写代码. 编写代码的难度,取决于周边代码的难度.要想轻松写代码,先让代码易读.

### 6. 童子军军规

光把代码写好还不够,必须时刻保持代码整洁. 

## 二. 有意义的命名

### 2.名副其实

选个好名字要花时间,但省下来的时间比花掉的多.

```java
// wrong
int d; // 消逝的时间

// well
int elapsedTimeInDays;
int daysSinceCreation;
int daysSinceModification;
int fileAgeInDays;
```

选择体现本意的名称能让人更容易理解和修改代码

```java
// wrong
public List<int[]> getThem(){
  List<int[]> list1 = new ArrayList<int[]>();
  for (int[] x : theList)
    if (x[0] == 4)
      list1.add(x);
  return list1;
}
```

以上代码没有复杂的表达式(逻辑直接了当), 空格和缩进规规矩矩(优雅,看起来像散文?), 只用到两三个变量(没有不必要的细节), 没有涉及到其他类或多态方法(没有不必要的依赖), 为什么却难以说明要做什么事情? 问题不在代码的简介度, 而在于代码的模糊度, 即代码的上下文未被明确体现.

> 我关于上下文理解: 输入的是什么? 输入不止是参数还应该包括逻辑中使用到的数据. 输出是什么? 其他开发者能看懂吗? 每个人的理解能力不一样, 解释能力也不一样, 但应该尽己所能的让会阅读你的代码的人更容易的看懂你的代码

举例: 开发一个扫雷游戏, 盘面是名为 theList 的单元格列表, 那就将其名称改为 gameBoard. 盘面上每个单元格使用一个简单数据表示, 零下标是一种状态值, 当其为 4 时表示"已标记".将变量名改为有意义的名称, 代码就会得到相当程度的改进. 

```java
// well
public List<int[]> getFlaggedCells(){
  List<int[]> flaggedCells = new ArrayList<int[]>();
  for (int[] cell : gameBroad)
    if (cell[STATUS_VALUE] == FLAGED)
      flaggedCells.add(cell);
  return flaggedCells;
}
```

代码的简洁性并未被触及

> 从这些方面来判断代码的简洁性: 变量, 运算符, 表达式, 嵌套, 依赖

### 3.避免误导

避免留下掩藏代码本意的错误线索. 避免使用错误的词或关键词.(尤其注意词的缩写带来的问题).

注意字母 I, O 和数字 1,0 造成的混淆.

> 注意词意误导与词形误导

### 4. 做有意义的区分

编写代码是要注意不能只是为了满足编译器或解释器的需要. 例如在同一作用域内两样不同的东西不能同名, 你可能会随手改掉其中一个名称, 有时干脆以错误的拼写凑数.

如果名称必须相异,那么意思也应该不同才对.以数字系列命名纯属误导, 完全没有提供正确信息.

```java
// wrong
public static void copyChars(char a1[], char a2[]) {
  for (int i = 0; i < a1.length; i++) {
    a2[i] = a1[i];
  }
}

// well
public static void copChars (char source[], char destination[]) {
  for (int i = 0; i < source.length; i++) {
    destination[i] = source[i];
  }
}
```

废话是另外一种没意义的区分,假设同时存在 Product, ProductInfo 和 ProductData 三个类,则虽然它们的名称不同, 意思却难以区别, 整洁的代码不应该存在类似意义含混的废话.

### 5. 使用读的出来的名称

善于利用大脑中处理语言的区域.

### 6. 使用可搜索的名称

这是单字母命名和数字常量存在的问题, 其很难在大片文字中找出来.

找 MAX_CLASS_PER_STUDENT 很容易, 但想找出数字 7 就麻烦了.

### 7. 避免使用编码

